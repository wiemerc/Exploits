from ctypes import WinDLL, POINTER, c_char


SECPKG_CRED_INBOUND = 1


# See https://stackoverflow.com/a/71643255 for other options. The best option seems to be pyspnego.
def main():
    dll = WinDLL("secur32.dll")
    creds_handle = POINTER(c_char)(c_char(8))
    tstamp = POINTER(c_char)(c_char(8))
    rv = dll.AcquireCredentialsHandleA(
        "",
        "Negotiate",
        SECPKG_CRED_INBOUND,
        None,
        None,
        None,
        None,
        creds_handle,
        tstamp,
    )
    print(f"AcquireCredentialsHandleA() returned {hex(int.from_bytes(rv.to_bytes(4, 'little', signed=True), 'little'))}, credentials handle = {creds_handle}")


if __name__ == "__main__":
    main()
